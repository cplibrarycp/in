<!DOCTYPE html>
<html lang="ml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Library Login System</title>
    <style>
        * { margin: 0; padding: 0; font-family: sans-serif; }
        .hero {
            height: 100%; width: 100%;
            background-image: linear-gradient(rgba(0,0,0,0.4),rgba(0,0,0,0.4)), url(https://images.unsplash.com/photo-1507842217343-583bb7260b66?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80);
            background-position: center; background-size: cover; position: absolute;
        }
        .form-box {
            width: 380px; height: 480px; position: relative; margin: 6% auto;
            background: #fff; padding: 5px; overflow: hidden; border-radius: 10px;
            box-shadow: 0 0 20px 9px #ff61241f;
        }
        .button-box {
            width: 220px; margin: 35px auto; position: relative;
            box-shadow: 0 0 20px 9px #ff61241f; border-radius: 30px;
        }
        .toggle-btn {
            padding: 10px 30px; cursor: pointer; background: transparent;
            border: 0; outline: none; position: relative; font-weight: bold;
        }
        #btn {
            top: 0; left: 0; position: absolute; width: 110px; height: 100%;
            background: linear-gradient(to right, #ff105f, #ffad06);
            border-radius: 30px; transition: .5s;
        }
        .input-group {
            top: 180px; position: absolute; width: 280px; transition: .5s;
        }
        .input-field {
            width: 100%; padding: 10px 0; margin: 5px 0;
            border-left: 0; border-top: 0; border-right: 0;
            border-bottom: 1px solid #999; outline: none; background: transparent;
        }
        .submit-btn {
            width: 85%; padding: 10px 30px; cursor: pointer; display: block; margin: auto;
            background: linear-gradient(to right, #ff105f, #ffad06);
            border: 0; outline: none; border-radius: 30px; color: #fff; margin-top: 20px;
        }
        #login { left: 50px; }
        #register { left: 450px; }
    </style>
</head>
<body>
    <div class="hero">
        <div class="form-box">
            <div class="button-box">
                <div id="btn"></div>
                <button type="button" class="toggle-btn" onclick="openLogin()">Log In</button>
                <button type="button" class="toggle-btn" onclick="openRegister()">Register</button>
            </div>
            <div id="login" class="input-group">
                <input type="email" id="loginEmail" class="input-field" placeholder="Email Id" required>
                <input type="password" id="loginPassword" class="input-field" placeholder="Enter Password" required>
                <button type="button" class="submit-btn" id="loginBtn">Log In</button>
            </div>
            <div id="register" class="input-group">
                <input type="text" id="regUser" class="input-field" placeholder="User Name" required>
                <input type="email" id="regEmail" class="input-field" placeholder="Email Id" required>
                <input type="password" id="regPassword" class="input-field" placeholder="Enter Password" required>
                <button type="button" class="submit-btn" id="regBtn">Register</button>
            </div>
        </div>
    </div>

    <script>
        var x = document.getElementById("login");
        var y = document.getElementById("register");
        var z = document.getElementById("btn");
        function openRegister() { x.style.left = "-400px"; y.style.left = "50px"; z.style.left = "110px"; }
        function openLogin() { x.style.left = "50px"; y.style.left = "450px"; z.style.left = "0"; }
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        // updateProfile ഇവിടെ അധികമായി ചേർത്തിട്ടുണ്ട്
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBzwhpHmeZdLf_nZrcPQirlnpj3Vhg9EqA", 
            authDomain: "thripudilibrary.firebaseapp.com",
            projectId: "thripudilibrary",
            storageBucket: "thripudilibrary.firebasestorage.app",
            messagingSenderId: "887018912750",
            appId: "1:887018912750:web:cc05190a72b13db816acff",
            measurementId: "G-B59RDW4KG4"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // രജിസ്ട്രേഷൻ (പേര് സേവ് ചെയ്യുന്ന പുതിയ കോഡ്)
        document.getElementById('regBtn').addEventListener('click', (e) => {
            const username = document.getElementById('regUser').value; // പേര് എടുക്കുന്നു
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;

            if(password.length < 6){ alert("പാസ്‌വേഡിന് ചുരുങ്ങിയത് 6 അക്ഷരങ്ങൾ വേണം"); return; }
            if(username === ""){ alert("ദയവായി പേര് നൽകുക"); return; }

            createUserWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    // ഇവിടെയാണ് പേര് അപ്‌ഡേറ്റ് ചെയ്യുന്നത്
                    updateProfile(user, {
                        displayName: username
                    }).then(() => {
                        alert("രജിസ്ട്രേഷൻ വിജയിച്ചു! ഇനി ലോഗിൻ ചെയ്യാം.");
                        openLogin();
                    });
                })
                .catch((error) => { alert("Error: " + error.message); });
        });

        // ലോഗിൻ
        document.getElementById('loginBtn').addEventListener('click', (e) => {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
                    window.location.href = "dashboard.html"; 
                })
                .catch((error) => {
                    alert("ലോഗിൻ പരാജയപ്പെട്ടു. വിവരങ്ങൾ പരിശോധിക്കുക.");
                });
        });
    </script>
</body>
</html>