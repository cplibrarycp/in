<!DOCTYPE html>
<html lang="ml">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>‡¥µ‡¥æ‡¥Ø‡¥® | THRIPUDI LIBRARY</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet"/>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background-color: #f0f0f0; }
        .reader-container { width: 100%; height: 100%; display: flex; flex-direction: column; }
        .error-message { 
            text-align: center; 
            padding: 50px; 
            font-family: Arial, sans-serif; 
            color: #d32f2f; 
            font-size: 1.2em; 
        }
        iframe { 
            border: none; 
            width: 100%; 
            height: 100%; 
            /* ‡¥™‡µç‡¥∞‡¥ß‡¥æ‡¥® ‡¥Æ‡¥æ‡¥±‡µç‡¥±‡¥Ç: iframe ‡¥∏‡µç‡¥±‡µç‡¥±‡µà‡¥≤‡¥ø‡µΩ ‡¥≤‡µã‡¥°‡¥ø‡¥Ç‡¥ó‡µç ‡¥ï‡¥æ‡¥£‡µÅ‡¥®‡µç‡¥®‡¥ø‡¥≤‡µç‡¥≤‡µÜ‡¥ô‡µç‡¥ï‡¥ø‡µΩ ‡¥ì‡¥ü‡µç‡¥ü‡µã‡¥Æ‡¥æ‡¥±‡µç‡¥±‡¥ø‡¥ï‡µç ‡¥∏‡µç‡¥ï‡µç‡¥∞‡µã‡µæ ‡¥â‡¥£‡µç‡¥ü‡¥æ‡¥µ‡¥æ‡¥§‡¥ø‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡µª */
            overflow: auto; 
        }
        .loading { 
            position: absolute; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            font-size: 2em; 
            color: #00897B; 
            font-family: Arial, sans-serif;
            z-index: 10;
        }
    </style>
</head>
<body>

<div class="reader-container">
    <div id="content">
        <div class="loading" id="loadingSpinner">
            <i class="fas fa-spinner fa-spin"></i> ‡¥™‡µÅ‡¥∏‡µç‡¥§‡¥ï‡¥Ç ‡¥≤‡µã‡¥°‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥®‡µÅ...
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const bookId = sessionStorage.getItem('currentBookId');
        const contentDiv = document.getElementById('content');
        const spinner = document.getElementById('loadingSpinner');

        if (!bookId) {
            spinner.style.display = 'none';
            contentDiv.innerHTML = `
                <div class="error-message">
                    <h1>üìö ‡¥™‡µÅ‡¥∏‡µç‡¥§‡¥ï‡¥Ç ‡¥ï‡¥£‡µç‡¥ü‡µÜ‡¥§‡µç‡¥§‡¥ø‡¥Ø‡¥ø‡¥≤‡µç‡¥≤!</h1>
                    <p>‡¥µ‡¥æ‡¥Ø‡¥® ‡¥§‡µÅ‡¥ü‡¥ô‡µç‡¥ô‡¥æ‡µª ‡¥ï‡¥¥‡¥ø‡¥û‡µç‡¥û‡¥ø‡¥≤‡µç‡¥≤. ‡¥¶‡¥Ø‡¥µ‡¥æ‡¥Ø‡¥ø ‡¥ó‡µç‡¥∞‡¥®‡µç‡¥•‡¥∂‡µá‡¥ñ‡¥∞‡¥§‡µç‡¥§‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µç <a href="collection.html">‡¥§‡¥ø‡¥∞‡¥ø‡¥ï‡µÜ ‡¥™‡µã‡¥ï‡µÅ‡¥ï</a>.</p>
                </div>
            `;
            return;
        }

        // ‚≠ê ‡¥Ö‡¥®‡µç‡¥§‡¥ø‡¥Æ ‡¥™‡¥∞‡¥ø‡¥π‡¥æ‡¥∞‡¥Ç: /embed ‡¥≤‡¥ø‡¥ô‡µç‡¥ï‡µç ‡¥∞‡µÄ‡¥§‡¥ø
        // ‡¥á‡¥§‡µç iFrame-‡µΩ PDF ‡¥≤‡µã‡¥°‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥æ‡µª ‡¥è‡¥±‡µç‡¥±‡¥µ‡µÅ‡¥Ç ‡¥ï‡µÇ‡¥ü‡µÅ‡¥§‡µΩ ‡¥∏‡¥æ‡¥ß‡µç‡¥Ø‡¥§‡¥Ø‡µÅ‡¥≥‡µç‡¥≥ ‡¥≤‡¥ø‡¥ô‡µç‡¥ï‡¥æ‡¥£‡µç.
        const embedUrl = \`https://drive.google.com/file/d/\${bookId}/embed\`;

        // Iframe-‡µΩ ‡¥™‡µÅ‡¥∏‡µç‡¥§‡¥ï‡¥Ç ‡¥§‡µÅ‡¥±‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ
        const iframeHtml = \`<iframe id="pdfFrame" src="\${embedUrl}" allowfullscreen></iframe>\`;
        
        // iframe ‡¥ö‡µá‡µº‡¥§‡µç‡¥§ ‡¥∂‡µá‡¥∑‡¥Ç ‡¥∏‡µç‡¥™‡¥ø‡¥®‡µç‡¥®‡µº ‡¥Æ‡¥±‡¥Ø‡µç‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥§‡¥ø‡¥®‡µÅ ‡¥™‡¥ï‡¥∞‡¥Ç, ‡¥∏‡µç‡¥™‡¥ø‡¥®‡µç‡¥®‡¥±‡¥ø‡¥®‡µÜ iframe-‡µª‡µç‡¥±‡µÜ ‡¥Æ‡µÅ‡¥ï‡¥≥‡¥ø‡µΩ ‡¥µ‡µÜ‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ.
        contentDiv.innerHTML = iframeHtml + spinner.outerHTML; 
        
        // iframe ‡¥≤‡µã‡¥°‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥§ ‡¥∂‡µá‡¥∑‡¥Ç ‡¥∏‡µç‡¥™‡¥ø‡¥®‡µç‡¥®‡µº ‡¥Æ‡¥±‡¥Ø‡µç‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ
        const frame = document.getElementById('pdfFrame');
        if (frame) {
            frame.onload = function() {
                // iframe ‡¥™‡µÇ‡µº‡¥£‡µç‡¥£‡¥Æ‡¥æ‡¥Ø‡¥ø ‡¥≤‡µã‡¥°‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥Æ‡µç‡¥™‡µã‡µæ ‡¥∏‡µç‡¥™‡¥ø‡¥®‡µç‡¥®‡µº ‡¥Æ‡¥±‡¥Ø‡µç‡¥ï‡µç‡¥ï‡µÅ‡¥ï.
                const currentSpinner = document.getElementById('loadingSpinner');
                if(currentSpinner) currentSpinner.style.display = 'none';
            };
        }

        // ‡¥≤‡µã‡¥°‡¥ø‡¥Ç‡¥ó‡µç ‡¥™‡¥∞‡¥æ‡¥ú‡¥Ø‡¥™‡µç‡¥™‡µÜ‡¥ü‡µç‡¥ü‡¥æ‡µΩ (Error Handler)
        setTimeout(() => {
            const currentSpinner = document.getElementById('loadingSpinner');
            if (currentSpinner && currentSpinner.style.display !== 'none') {
                currentSpinner.style.display = 'none';
                contentDiv.innerHTML = `
                <div class="error-message">
                    <h1>‚ö†Ô∏è ‡¥≤‡µã‡¥°‡¥ø‡¥Ç‡¥ó‡µç ‡¥™‡¥∞‡¥æ‡¥ú‡¥Ø‡¥Ç</h1>
                    <p>‡¥´‡¥Ø‡µΩ ‡¥≤‡µã‡¥°‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥®‡¥§‡¥ø‡µΩ ‡¥ó‡µÅ‡¥∞‡µÅ‡¥§‡¥∞‡¥Æ‡¥æ‡¥Ø ‡¥§‡¥ü‡¥∏‡µç‡¥∏‡¥Ç ‡¥®‡µá‡¥∞‡¥ø‡¥ü‡µç‡¥ü‡µÅ. ‡¥à PDF ‡¥´‡¥Ø‡¥≤‡¥ø‡¥®‡µç Google Drive-‡µΩ <b>'Anyone with the link (Viewer)'</b> ‡¥™‡µÜ‡µº‡¥Æ‡¥ø‡¥∑‡µª ‡¥â‡¥£‡µç‡¥ü‡µã ‡¥é‡¥®‡µç‡¥®‡µç ‡¥â‡¥±‡¥™‡µç‡¥™‡µÅ‡¥µ‡¥∞‡µÅ‡¥§‡µç‡¥§‡µÅ‡¥ï.</p>
                    <p><i>(‡¥™‡¥¨‡µç‡¥≤‡¥ø‡¥ï‡µç ‡¥Ü‡¥ï‡µç‡¥∏‡¥∏‡µç ‡¥™‡µç‡¥∞‡¥∂‡µç‡¥®‡¥ô‡µç‡¥ô‡µæ Google-‡µª‡µç‡¥±‡µÜ ‡¥≠‡¥æ‡¥ó‡¥§‡µç‡¥§‡µÅ‡¥®‡¥ø‡¥®‡µç‡¥®‡µÅ‡¥Ç ‡¥â‡¥£‡µç‡¥ü‡¥æ‡¥ï‡¥æ‡¥Ç.)</i></p>
                </div>
                `;
            }
        }, 15000); // 15 ‡¥∏‡µÜ‡¥ï‡µç‡¥ï‡µª‡¥°‡µç
    });
</script>

</body>
</html>
