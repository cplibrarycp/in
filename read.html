<!DOCTYPE html>
<html lang="ml">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>‡¥µ‡¥æ‡¥Ø‡¥® | THRIPUDI LIBRARY</title>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background-color: #f0f0f0; }
        .reader-container { width: 100%; height: 100%; display: flex; flex-direction: column; }
        .error-message { 
            text-align: center; 
            padding: 50px; 
            font-family: Arial, sans-serif; 
            color: #d32f2f; 
            font-size: 1.2em; 
        }
        iframe { border: none; width: 100%; height: 100%; }
        /* ‡¥≤‡µã‡¥°‡¥ø‡¥Ç‡¥ó‡µç ‡¥∏‡µç‡¥™‡¥ø‡¥®‡µç‡¥®‡µº (‡¥ï‡¥æ‡¥¥‡µç‡¥ö‡¥Ø‡¥ø‡µΩ ‡¥≠‡¥Ç‡¥ó‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡¥Ø‡¥ø) */
        .loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 2em; color: #00897B; }
    </style>
</head>
<body>

<div class="reader-container">
    <div id="content">
        <div class="loading" id="loadingSpinner"><i class="fas fa-spinner fa-spin"></i> ‡¥≤‡µã‡¥°‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡µÅ‡¥®‡µç‡¥®‡µÅ...</div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const bookId = sessionStorage.getItem('currentBookId');
        const contentDiv = document.getElementById('content');
        const spinner = document.getElementById('loadingSpinner');

        if (!bookId) {
            spinner.style.display = 'none';
            contentDiv.innerHTML = `
                <div class="error-message">
                    <h1>üìö ‡¥™‡µÅ‡¥∏‡µç‡¥§‡¥ï‡¥Ç ‡¥ï‡¥£‡µç‡¥ü‡µÜ‡¥§‡µç‡¥§‡¥ø‡¥Ø‡¥ø‡¥≤‡µç‡¥≤!</h1>
                    <p>‡¥µ‡¥æ‡¥Ø‡¥® ‡¥§‡µÅ‡¥ü‡¥ô‡µç‡¥ô‡¥æ‡µª ‡¥ï‡¥¥‡¥ø‡¥û‡µç‡¥û‡¥ø‡¥≤‡µç‡¥≤. ‡¥¶‡¥Ø‡¥µ‡¥æ‡¥Ø‡¥ø ‡¥ó‡µç‡¥∞‡¥®‡µç‡¥•‡¥∂‡µá‡¥ñ‡¥∞‡¥§‡µç‡¥§‡¥ø‡¥≤‡µá‡¥ï‡µç‡¥ï‡µç <a href="collection.html">‡¥§‡¥ø‡¥∞‡¥ø‡¥ï‡µÜ ‡¥™‡µã‡¥ï‡µÅ‡¥ï</a>.</p>
                </div>
            `;
            return;
        }

        // ‚≠ê ‡¥™‡µÅ‡¥§‡¥ø‡¥Ø Embed Link ‡¥∞‡µÄ‡¥§‡¥ø: /preview? 
        // ‡¥à ‡¥∞‡µÄ‡¥§‡¥ø‡¥ï‡µç‡¥ï‡µç ‡¥™‡µä‡¥§‡µÅ‡¥µ‡µÜ ‡¥®‡¥≤‡µç‡¥≤ ‡¥µ‡¥ø‡¥∂‡µç‡¥µ‡¥æ‡¥∏‡µç‡¥Ø‡¥§‡¥Ø‡µÅ‡¥£‡µç‡¥ü‡µç.
        const embedUrl = \`https://drive.google.com/file/d/\${bookId}/preview\`;

        // Iframe-‡µΩ ‡¥™‡µÅ‡¥∏‡µç‡¥§‡¥ï‡¥Ç ‡¥§‡µÅ‡¥±‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ
        const iframeHtml = \`<iframe id="pdfFrame" src="\${embedUrl}" allowfullscreen></iframe>\`;
        
        // iframe ‡¥ö‡µá‡µº‡¥§‡µç‡¥§ ‡¥∂‡µá‡¥∑‡¥Ç ‡¥∏‡µç‡¥™‡¥ø‡¥®‡µç‡¥®‡µº ‡¥Æ‡¥±‡¥Ø‡µç‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡µÅ
        contentDiv.innerHTML = iframeHtml;
        spinner.style.display = 'none';

        // ‡¥í‡¥∞‡µÅ‡¥™‡¥ï‡µç‡¥∑‡µá ‡¥≤‡µã‡¥°‡¥ø‡¥Ç‡¥ó‡µç ‡¥§‡¥ü‡¥∏‡µç‡¥∏‡¥™‡µç‡¥™‡µÜ‡¥ü‡µç‡¥ü‡¥æ‡µΩ, 10 ‡¥∏‡µÜ‡¥ï‡µç‡¥ï‡µª‡¥°‡¥ø‡¥®‡µç ‡¥∂‡µá‡¥∑‡¥Ç ‡¥í‡¥∞‡µÅ ‡¥Æ‡µÜ‡¥∏‡µç‡¥∏‡µá‡¥ú‡µç ‡¥ï‡¥æ‡¥£‡¥ø‡¥ï‡µç‡¥ï‡¥æ‡¥Ç
        setTimeout(() => {
            const frame = document.getElementById('pdfFrame');
            if (frame && frame.contentWindow.document.body.innerHTML === "") {
                // If it's still blank after 10s, it's likely a permission error.
                contentDiv.innerHTML = `
                <div class="error-message">
                    <h1>‚ö†Ô∏è ‡¥≤‡µã‡¥°‡¥ø‡¥Ç‡¥ó‡µç ‡¥§‡¥ï‡¥∞‡¥æ‡µº</h1>
                    <p>‡¥´‡¥Ø‡µΩ ‡¥≤‡µã‡¥°‡µç ‡¥ö‡µÜ‡¥Ø‡µç‡¥Ø‡¥æ‡µª ‡¥ï‡¥¥‡¥ø‡¥û‡µç‡¥û‡¥ø‡¥≤‡µç‡¥≤. ‡¥à ‡¥´‡¥Ø‡¥≤‡¥ø‡¥®‡µç Google Drive-‡µΩ **'Anyone with the link'** ‡¥é‡¥®‡µç‡¥® ‡¥∑‡µÜ‡¥Ø‡¥±‡¥ø‡¥Ç‡¥ó‡µç ‡¥™‡µÜ‡µº‡¥Æ‡¥ø‡¥∑‡µª ‡¥â‡¥£‡µç‡¥ü‡µã ‡¥é‡¥®‡µç‡¥®‡µç ‡¥â‡¥±‡¥™‡µç‡¥™‡µÅ‡¥µ‡¥∞‡µÅ‡¥§‡µç‡¥§‡µÅ‡¥ï.</p>
                </div>
                `;
            }
        }, 10000); // 10 ‡¥∏‡µÜ‡¥ï‡µç‡¥ï‡µª‡¥°‡µç
    });
    
    // ‡¥≤‡µã‡¥ó‡¥ø‡µª ‡¥∏‡µç‡¥±‡µç‡¥±‡¥æ‡¥±‡µç‡¥±‡¥∏‡µç ‡¥ö‡µÜ‡¥ï‡µç‡¥ï‡¥ø‡¥Ç‡¥ó‡µç ‡¥Ü‡¥µ‡¥∂‡µç‡¥Ø‡¥Æ‡¥ø‡¥≤‡µç‡¥≤‡¥æ‡¥§‡µç‡¥§‡¥§‡¥ø‡¥®‡¥æ‡µΩ ‡¥Æ‡¥±‡µç‡¥±‡µç ‡¥∏‡µç‡¥ï‡µç‡¥∞‡¥ø‡¥™‡µç‡¥±‡µç‡¥±‡µÅ‡¥ï‡µæ ‡¥á‡¥µ‡¥ø‡¥ü‡µÜ ‡¥ö‡µá‡µº‡¥ï‡µç‡¥ï‡µÅ‡¥®‡µç‡¥®‡¥ø‡¥≤‡µç‡¥≤.
</script>

</body>
</html>
