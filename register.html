<!DOCTYPE html>
<html lang="ml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>അംഗമാകുക | THRIPUDI LIBRARY</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- തീം സെറ്റിംഗ്സ് --- */
        :root {
            --primary-teal: #00897B;
            --secondary-dark: #004D40;
            --text-light: #FFFFFF;
            --overlay-gradient: linear-gradient(135deg, rgba(0, 77, 64, 0.85) 0%, rgba(0, 137, 123, 0.85) 100%);
        }

        body {
            font-family: 'Poppins', sans-serif;
            margin: 0; padding: 0; height: 100vh;
            display: flex; justify-content: center; align-items: center;
            background-image: var(--overlay-gradient), url('https://images.unsplash.com/photo-1507842217343-583bb7270b66?ixlib=rb-1.2.1&auto=format&fit=crop&w=1950&q=80');
            background-size: cover; background-position: center;
        }

        .register-container {
            background: rgba(255, 255, 255, 0.15);
            padding: 40px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
            width: 100%; max-width: 400px;
            text-align: center; color: white;
        }

        h2 { margin-bottom: 20px; font-weight: 700; letter-spacing: 1px; }

        .input-group { margin-bottom: 15px; text-align: left; }
        .input-group label { display: block; margin-bottom: 5px; font-size: 0.9em; font-weight: 500; }
        
        .input-group input {
            width: 100%; padding: 12px;
            border: none; border-radius: 5px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 1em; box-sizing: border-box;
            outline: none; transition: 0.3s;
        }
        .input-group input:focus { box-shadow: 0 0 10px rgba(0, 137, 123, 0.5); }

        .btn-register {
            background-color: var(--primary-teal);
            color: white; padding: 12px; width: 100%;
            border: none; border-radius: 5px;
            font-size: 1.1em; font-weight: 600; cursor: pointer;
            margin-top: 10px; transition: 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        .btn-register:hover { background-color: var(--secondary-dark); transform: translateY(-2px); }

        .login-link { margin-top: 20px; font-size: 0.9em; }
        .login-link a { color: #ffeb3b; text-decoration: none; font-weight: 600; }
        .login-link a:hover { text-decoration: underline; }

        #error-msg { color: #ff5252; margin-top: 10px; display: none; background: rgba(0,0,0,0.5); padding: 5px; border-radius: 4px; font-size: 0.9em; }
    </style>
</head>
<body>

    <div class="register-container">
        <h2>പുതിയ അംഗമാകുക</h2>
        <form id="registerForm">
            <div class="input-group">
                <label>നിങ്ങളുടെ പേര്</label>
                <input type="text" id="fullName" required placeholder="Full Name">
            </div>
            <div class="input-group">
                <label>ഇമെയിൽ</label>
                <input type="email" id="email" required placeholder="example@gmail.com">
            </div>
            <div class="input-group">
                <label>പാസ്‌വേഡ് (കുറഞ്ഞത് 6 അക്ഷരം)</label>
                <input type="password" id="password" required placeholder="******" minlength="6">
            </div>
            
            <button type="submit" class="btn-register">Register</button>
            <p id="error-msg"></p>
        </form>

        <div class="login-link">
            അക്കൗണ്ട് ഉണ്ടോ? <a href="login.html">ലോഗിൻ ചെയ്യുക</a>
        </div>
    </div>

    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";

        const firebaseConfig = { apiKey: "AIzaSyBzwhpHmeZdLf_nZrcPQirlnpj3Vhg9EqA", authDomain: "thripudilibrary.firebaseapp.com", projectId: "thripudilibrary", storageBucket: "thripudilibrary.firebasestorage.app", messagingSenderId: "887018912750", appId: "1:887018912750:web:cc05190a72b13db816acff", measurementId: "G-B59RDW4KG4" };
        const app = initializeApp(firebaseConfig); 
        const auth = getAuth(app);

        onAuthStateChanged(auth, async (user) => {
            const nameDisplay = document.getElementById('display-name');
            const avatarDiv = document.getElementById('userAvatar');

            if (user) {
                try { await user.reload(); } catch(e) {}
                const currentUser = auth.currentUser;
                const displayName = currentUser.displayName ? currentUser.displayName.split(' ')[0] : currentUser.email.split('@')[0];
                if(nameDisplay) nameDisplay.textContent = displayName;
                if (currentUser.photoURL && avatarDiv) avatarDiv.innerHTML = `<img src="${currentUser.photoURL}" alt="Profile">`;

                setupHistoryOnly(user.uid);
            }
        });

        const logoutLink = document.getElementById('logout-link');
        if(logoutLink) {
            logoutLink.addEventListener('click', (e) => { 
                e.preventDefault(); 
                signOut(auth).then(() => { window.location.href = "index.html"; }); 
            });
        }

        window.setupHistoryOnly = function(uid) {
            const buttons = document.querySelectorAll(".overlay-btn");
            buttons.forEach(btn => {
                const newBtn = btn.cloneNode(true);
                btn.parentNode.replaceChild(newBtn, btn);
                
                newBtn.addEventListener("click", function(e) {
                    // ഇവിടെ preventDefault ഇല്ല, കാരണം read.html ലേക്ക് പോകണം
                    const card = this.closest('.book-card');
                    const linkUrl = this.getAttribute('href'); // read.html link
                    
                    if (card) {
                        const title = card.querySelector('.book-title').innerText;
                        const image = card.querySelector('.book-cover').src;
                        const date = new Date().toLocaleDateString('ml-IN');
                        const key = 'history_' + uid;
                        let history = JSON.parse(localStorage.getItem(key)) || [];
                        history = history.filter(item => item.title !== title);
                        history.unshift({ title, image, url: linkUrl, date });
                        if (history.length > 50) history.pop();
                        localStorage.setItem(key, JSON.stringify(history));
                    }
                });
            });
        };
    </script>
    <script>
        function toggleProfileMenu() { 
            var dropdown = document.querySelector(".profile-dropdown"); 
            if(dropdown) dropdown.style.display = dropdown.style.display === "block" ? "none" : "block"; 
        }
        window.onclick = function(event) {
            if (!event.target.closest('.user-profile')) {
                var dropdowns = document.getElementsByClassName("profile-dropdown");
                for (var i = 0; i < dropdowns.length; i++) { dropdowns[i].style.display = "none"; }
            }
        }
        function searchBooks() { var input = document.getElementById('searchBar'); if(!input) return; var filter = input.value.toUpperCase(); var cards = document.getElementsByClassName('book-card'); for (var i = 0; i < cards.length; i++) { var title = cards[i].getElementsByClassName("book-title")[0]; if (title) { var txtValue = title.textContent || title.innerText; cards[i].style.display = txtValue.toUpperCase().indexOf(filter) > -1 ? "" : "none"; } } }
    </script>
</body>
</html>
